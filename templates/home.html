{% extends 'base.html' %}
{% load i18n %}
{% load tagging_tags %}
{% load staticfiles %}
{% block content %}

    <div ng-controller="PublicationController as ctrl" ng-init="ctrl.init()">

        <a data-toggle="collapse" data-target="#templatetab" href="#add"><img id="add"
                                                                              src="{% static 'icons/add_red.png' %}"></a>
        <div id="templatetab" class="col-md-3 collapse">
            <div id="templatepanel" class="panel panel-success">
                <div class="panel-heading">
                    <h3>{% trans 'Templates' %}</h3>
                </div>
                <div class="panel-body list-group" id="templatelist">
                    {% for template in templates %}
                        <a href="{% url 'create-publication' template.id %}" class="list-group-item">
                            <label>{{ template.name }}</label>
                            <img id="photo" class="img-thumbnail" src="{{ template.preview_link }}">
                        </a>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="col-md-2" ng-cloak ng-show="!ctrl.viewProfile">
            <div class="panel panel-success">
                <div class="panel-heading">
                    <h3 class="panel-title">{% trans 'Categories' %}</h3>
                </div>
                <div class="list-group">
                    {% for category in categories %}
                        <a href="#{{ category.name }}" ng-click="ctrl.setFilter({{ category.id }})"
                           class="list-group-item">{% trans category.name %}</a>
                    {% endfor %}
                </div>
            </div>
            <div class="tagcloud hidden-xs hidden-sm">
                <div ng-controller="TagController as ctrl2" ng-init="ctrl2.init()">
                    {% verbatim %}
                   <span ng-cloak ng-repeat="tag in ctrl2.tags" class="cloud_{{ tag.Weight }}">
                       <a href="#{{tag.TagName}}">{{ tag.TagName }}</a>
                   </span>
                    {% endverbatim %}
                </div>
            </div>
        </div>

        <div class="col-md-3" ng-show="ctrl.viewProfile">
            {% verbatim %}
            <div class="panel panel-success">
                <div class="panel-heading">
                    <h2 class="text-center">@{{ ctrl.userProfile.profile.username }}</h2>
                </div>
                <div class="panel-body list-group">
                    <img id="photo" class="img-responsive img-thumbnail" src="{{ ctrl.userProfile.profile.photo }}">
                    <div class="list-group-item">
                        <label class="label label-info">email:</label>
                        <span class="pull-right">{{ ctrl.userProfile.profile.email }}</span>
                    </div>
                    {% endverbatim %}
                    <div class="list-group-item">
                        <label class="label label-info">{% trans 'Gender' %}:</label>
                        <span class="pull-right">{% verbatim %}{{ ctrl.userProfile.profile.gender }}{% endverbatim %}</span>
                    </div>
                    <div class="list-group-item">
                        <label class="label label-info">{% trans 'Location' %}:</label>
                        <span class="pull-right">{% verbatim %}{{ ctrl.userProfile.profile.location }}{% endverbatim %}</span>
                    </div>
                    <div class="list-group-item">
                        <label class="label label-info">{% trans 'About' %}:</label>
                        <span class="pull-right">{% verbatim %}{{ ctrl.userProfile.profile.about}}{% endverbatim %}</span>
                    </div>
                    <div class="list-group-item">
                        <label class="label label-info">{% trans 'Karma' %}:</label>
                        {% verbatim %}
                        <span ng-show="ctrl.userProfile.profile.karma > 0" class="badge plus pull-right">+{{ ctrl.userProfile.profile.karma }}</span>
                        <span ng-show="ctrl.userProfile.profile.karma == 0" class="badge nul pull-right">{{ ctrl.userProfile.profile.karma }}</span>
                        <span ng-show="ctrl.userProfile.profile.karma < 0" class="badge minus pull-right">{{ ctrl.userProfile.profile.karma }}</span>
                        {% endverbatim %}
                    </div>
                    <div class="list-group-item"
                         ng-repeat="achievement in ctrl.userProfile.achievements track by $index">
                        {% verbatim %}
                        <img class="img-thumbnail" src="{{ achievement.picture }}" style="width: 80px; height: 80px">
                        {% endverbatim %}
                    </div>
                </div>
            </div>
        </div>
        <div infinite-scroll='ctrl.loadMore()' infinite-scroll-disabled='ctrl.busy' infinite-scroll-distance='1'>
            <div class="publ col-md-8 pull-right" ng-repeat="publication in ctrl.publications track by $index">
                {% verbatim %}
                <div class="panel panel-success">
                    <div class="panel-heading">
                        <a href="/articles/{{ publication.id }}">
                            <h3 id="title" class="panel-title">{{ publication.header }}</h3>
                        </a>
                    </div>
                    <div class="panel-body">
                        <a href="/articles/{{ publication.id }}">
                            <div class="col-md-4 text-center">
                                <img style="max-height: 100px;" class="img-responsive img-thumbnail"
                                     src="{{ publication.image }}">
                            </div>
                        </a>

                        <div class="well col-md-8">
                            {{ publication.description }}
                        </div>

                        <ul class="breadcrumb col-md-12">
                            <li>{{publication.category }}</li>
                            <li><span class="label label-success">
                                <a href="#{{publication.author }}" ng-click="ctrl.setFilter(0,publication.author)">{{publication.author
                                    }}</a>
                            </span>
                            </li>
                            <li class="active">{{publication.created_at | date:'medium'}}</li>
                            <li><span ng-show="publication.rate > 0" class="badge plus">+{{ publication.rate }}</span>
                                <span ng-show="publication.rate == 0" class="badge nul">{{ publication.rate }}</span>
                                <span ng-show="publication.rate < 0" class="badge minus">{{ publication.rate }}</span>
                            </li>
                            {% endverbatim %}
                            {% if user.is_authenticated %}
                                <li>
                                    <a href="" ng-click="ctrl.vote(publication.id,'True')" ng-cloak
                                       ng-hide="(publication.like == true)"><i style="font-size: 18px; color: #18bc9c;"
                                                                               class="fa fa-thumbs-up"></i></a>
                                    <a href="" ng-click="ctrl.vote(publication.id,'True')" ng-cloak
                                       ng-show="(publication.like == true)"><i style="font-size: 25px; color: #e74c3c;"
                                                                               class="fa fa-thumbs-up"></i></a>
                                    <a href="" ng-click="ctrl.vote(publication.id,'False')" ng-cloak
                                       ng-hide="(publication.like == false)"><i style="font-size: 18px; color: #18bc9c;"
                                                                                class="fa fa-thumbs-down"></i></a>
                                    <a href="" ng-click="ctrl.vote(publication.id,'False')" ng-cloak
                                       ng-show="(publication.like == false)"><i style="font-size: 25px; color: #e74c3c;"
                                                                                class="fa fa-thumbs-down"></i></a>
                                </li>
                            {% endif %}
                            <li>
                                {% verbatim %}
                                <a href="/articles/{{ publication.id }}/#commentsblock">
                                    <i style="font-size: 15px; color: #18bc9c;" class="fa fa-comments">5</i></a>
                                {% endverbatim %}
                            </li>
                        </ul>
                    </div>
                </div>
                {% verbatim %}
                <ul class="tagslabel">
                    <li ng-repeat="tag in publication.tag"><a href="#{{ tag }}">{{ tag }}</a></li>
                </ul>
                {% endverbatim %}
            </div>
        </div>
    </div>

{% endblock %}

